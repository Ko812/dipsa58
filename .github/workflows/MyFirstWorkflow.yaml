name: My First Workflow

# trigger
on:
  push:
    branches:
      - 'release/v[0-9]+.[0-9]+'

jobs:
  # name of your job
  my-first-job:
    # runner
    runs-on: ubuntu-latest
    permissions: write-all
    # steps in this job
    steps:
      # - name: Run Trivy vulnerability scanner in fs mode
        # uses: aquasecurity/trivy-action@master
        # with:
          # scan-type: 'repo'
          # ignore-unfixed: true
          # format: 'github'
          # github-pat: ${{secrets.GH_TOKEN}}
          # output: 'dependency-results.sbom.json'
          # severity: 'LOW'
      # - name: Upload trivy report as a Github artifact
        # uses: actions/upload-artifact@v4
        # with:
          # name: trivy-sbom-report
          # path: '${{ github.workspace }}/dependency-results.sbom.json'
          # retention-days: 2 # 90 is the default
      # - name: Download artifact
        # uses: actions/download-artifact@v4
        # with:
          # name: trivy-sbom-report
      # - name: echo the git branch
        # uses: mscoutermarsh/cowsays-action@master
        # with:
          # text: "I am on branch ${{github.workspace}}"
          # color: cyan
      - name: Send custom JSON data to Slack workflow
        id: slack
        uses: slackapi/slack-github-action@v1.26.0
        with:
          payload: |
            {
                "text": "GitHub Action build result",
                "blocks": [
                    {
                        "type": "header",
                        "text": {
                            "type": "plain_text",
                            "text": "New request",
                            "emoji": true
                        }
                    },
                    {
                        "type": "section",
                        "fields": [
                            {
                                "type": "mrkdwn",
                                "text": "*Ref*\n${{github.ref}}"
                            },
                            {
                                "type": "mrkdwn",
                                "text": "*Event*\n${{github.event}}"
                            }
                        ]
                    },
                    {
                        "type": "section",
                        "fields": [
                            {
                                "type": "mrkdwn",
                                "text": "*Actions URL*\nBuild and Push"
                            },
                            {
                                "type": "mrkdwn",
                                "text": "*Commit*\n${{github.event.head_commit}}"
                            }
                        ]
                    },
                    {
                        "type": "section",
                        "fields": [
                            {
                                "type": "mrkdwn",
                                "text": "*Image build and signed*"
                            }
                        ]
                    },
                    {
                        "type": "section",
                        "fields": [
                            {
                                "type": "mrkdwn",
                                "text": "*Name:* Kevin Oh"
                            }
                        ]
                    },
                    {
                        "type": "section",
                        "fields": [
                            {
                                "type": "mrkdwn",
                                "text": "*Matriculation:* A0023945E"
                            }
                        ]
                    },
                    {
                        "type": "section",
                        "fields": [
                            {
                                "type": "mrkdwn",
                                "text": "*Email:* ohsl265@gmail.com"
                            }
                        ]
                    },
                    {
                        "type": "section",
                        "fields": [
                            {
                                "type": "mrkdwn",
                                "text": "*Git:* https://github.com/ko812/go-fortune"
                            }
                        ]
                    },
                    {
                        "type": "section",
                        "fields": [
                            {
                                "type": "mrkdwn",
                                "text": "*Image:* https://hub.docker/repository/docker/ko812/go-fortune"
                            }
                        ]
                    }
                ]
            }
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.MYTUNNEL }}
          SLACK_WEBHOOK_TYPE: INCOMING_WEBHOOK
